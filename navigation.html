<!-- Navigation component for reuse across sites -->
<nav class="main-navigation">
    <div class="nav-container">
        <div class="nav-brand">
            <a href="/index.html" class="nav-logo" id="nav-home-link">1135</a>
        </div>
        <div class="nav-notes">
            <div class="nav-dropdown">
                <button class="nav-dropdown-btn">
                    <span data-i18n="nav_tools">Â∑•ÂÖ∑ÈõÜÂêà</span>
                    <span>‚ñº</span>
                </button>
                <div class="nav-dropdown-content" id="navDropdown">
                    <div class="dropdown-section">
                        <h4 class="dropdown-section-title" data-i18n="nav_web_security">WebÊîªÈò≤Â∑•ÂÖ∑</h4>
                        <a href="../exec/index.html" class="dropdown-link" data-i18n="tool_exec_title">ÂëΩ‰ª§ÂèòÂΩ¢Â∑•ÂÖ∑</a>
                        <a href="../xss_weaponization/index.html" class="dropdown-link"
                            data-i18n="tool_xss_title">XSSÊ≠¶Âô®Âåñ</a>
                        <a href="../diff_tool/index.html" class="dropdown-link" data-i18n="tool_diff_title">DiffÂ∑•ÂÖ∑</a>
                        <a href="../ip_tool/index.html" class="dropdown-link" data-i18n="tool_ip_title">IPÂ∑•ÂÖ∑ÁÆ±</a>
                    </div>
                    <div class="dropdown-section">
                        <h4 class="dropdown-section-title" data-i18n="nav_general">ÈÄöÁî®Â∑•ÂÖ∑</h4>
                        <a href="../markdown2pdf/index.html" class="dropdown-link"
                            data-i18n="tool_md2pdf_title">Markdown to PDF</a>
                        <a href="../universal_editor/index.html" class="dropdown-link"
                            data-i18n="tool_editor_title">ÈÄöÁî®ÁºñËæëÂô®</a>
                        <a href="../totp-generator/index.html" class="dropdown-link"
                            data-i18n="tool_totp_title">TOTPÁîüÊàêÂô®</a>
                        <a href="https://gchq.github.io/CyberChef/" class="dropdown-link" target="_blank">
                            <span data-i18n="tool_cyberchef_title">CyberChef</span>
                            <span style="font-size: 0.75em; opacity: 0.7;" data-i18n="third_party">(Á¨¨‰∏âÊñπ)</span>
                        </a>
                        <a href="https://hemmelig.app/" class="dropdown-link" target="_blank">
                            <span data-i18n="tool_hemmelig_title">Hemmelig</span>
                            <span style="font-size: 0.75em; opacity: 0.7;" data-i18n="third_party">(Á¨¨‰∏âÊñπ)</span>
                        </a>
                    </div>
                    <div class="dropdown-section">
                        <h4 class="dropdown-section-title" data-i18n="nav_demos">ÊºîÁ§∫/Demo</h4>
                        <a href="../0/login.html" class="dropdown-link" data-i18n="tool_login_demo_title">ÁôªÂΩïÈ°µÈù¢ÊºîÁ§∫</a>
                        <a href="../2/download.html" class="dropdown-link" data-i18n="tool_download_title">HTML
                            Smuggling</a>
                        <a href="../3/read_clipborad.html" class="dropdown-link"
                            data-i18n="tool_clipboard_title">Ââ™Ë¥¥ÊùøËØªÂèñ</a>
                        <a href="../4/page.html" class="dropdown-link" data-i18n="tool_phishing_title">ÈíìÈ±ºÈ°µÈù¢ÊºîÁ§∫</a>
                        <a href="../5/read_localfile.html" class="dropdown-link"
                            data-i18n="tool_localfile_title">Êú¨Âú∞Êñá‰ª∂ËØªÂèñ</a>
                        <a href="../demo_postMessage/index.html" class="dropdown-link"
                            data-i18n="tool_postmessage_title">postMessageÊºèÊ¥ûÊºîÁ§∫</a>
                    </div>
                </div>
            </div>
            <button class="lang-toggle-btn">
                <span class="lang-icon">EN</span>
            </button>
            <button class="theme-toggle-btn">
                <span class="theme-icon">üåô</span>
            </button>
            <div class="notes-dropdown">
                <button class="notes-toggle-btn" data-i18n-title="notes_button_title" title="Á¨îËÆ∞">
                    üìñ
                </button>
                <div class="notes-dropdown-content">
                    <a href="https://github.com/1135/notes/blob/master/README.md" target="_blank"
                        data-i18n="nav_notes_public">üìó ÂÖ¨ÂºÄÁ¨îËÆ∞</a>
                    <a href="https://github.com/1135/notes_private/blob/master/README.md" target="_blank"
                        data-i18n="nav_notes_private">üìï ÁßÅÊúâÁ¨îËÆ∞ üîí</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<script>
    // Dropdown toggle functionality
    // Dropdown toggle functionality and Path Fixing
    (function () {
        const initNavigation = function () {
            // Determine if we are in a sub-site (e.g. sites/markdown2pdf/) or at root
            const currentPath = window.location.pathname;
            const isInSites = currentPath.includes('/sites/');

            // Fix home link
            const homeLink = document.getElementById('nav-home-link');
            if (homeLink) {
                if (isInSites) {
                    // In sub-site: go up two levels to root
                    homeLink.href = '../../index.html';
                } else {
                    // At root: stay at index.html
                    homeLink.href = 'index.html';
                }
            }

            // Fix tool links
            // Default links in HTML are relative to sub-sites: "../tool/index.html"
            const toolLinks = document.querySelectorAll('.dropdown-link');
            toolLinks.forEach(link => {
                const originalHref = link.getAttribute('href');
                if (!originalHref) return;

                // Skip external links
                if (originalHref.startsWith('http') || originalHref.startsWith('//')) return;

                if (isInSites) {
                    // We are in a sub-site (e.g. sites/markdown2pdf/)
                    // The default links "../tool/index.html" are CORRECT for sibling tools.
                    // No change needed.
                } else {
                    // We are at root (index.html)
                    // The default links "../tool/index.html" are WRONG.
                    // We need to change "../" to "sites/" to point to "sites/tool/index.html".
                    if (originalHref.startsWith('../')) {
                        link.href = originalHref.replace('../', 'sites/');
                    }
                }
            });

            // Dropdown event listeners
            const dropdownBtn = document.querySelector('.nav-dropdown-btn');
            const dropdownContent = document.querySelector('.nav-dropdown-content');

            if (dropdownBtn && dropdownContent) {
                // Clone to remove old listeners
                const newBtn = dropdownBtn.cloneNode(true);
                dropdownBtn.parentNode.replaceChild(newBtn, dropdownBtn);

                newBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    dropdownContent.classList.toggle('show');
                    const notesDropdown = document.querySelector('.notes-dropdown-content');
                    if (notesDropdown) notesDropdown.classList.remove('show');
                });
            }

            const notesBtn = document.querySelector('.notes-toggle-btn');
            const notesContent = document.querySelector('.notes-dropdown-content');

            if (notesBtn && notesContent) {
                const newBtn = notesBtn.cloneNode(true);
                notesBtn.parentNode.replaceChild(newBtn, notesBtn);

                newBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    notesContent.classList.toggle('show');
                    if (dropdownContent) dropdownContent.classList.remove('show');
                });
            }

            document.addEventListener('click', function (e) {
                if (dropdownContent && !e.target.closest('.nav-dropdown')) {
                    dropdownContent.classList.remove('show');
                }
                if (notesContent && !e.target.closest('.notes-dropdown')) {
                    notesContent.classList.remove('show');
                }
            });
            // 1. Unified Footer Injection
            const injectFooter = function () {
                // Add Back to Top button if not exists
                if (!document.getElementById('back-to-top')) {
                    const bttHTML = `
                    <div id="back-to-top" title="Back to Top">
                        <svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg>
                    </div>`;
                    document.body.insertAdjacentHTML('beforeend', bttHTML);
                }

                // Initialize Back to Top
                const btt = document.getElementById('back-to-top');
                if (btt && !btt.dataset.initialized) {
                    window.addEventListener('scroll', () => {
                        if (window.scrollY > 300) {
                            btt.classList.add('show');
                        } else {
                            btt.classList.remove('show');
                        }
                    });
                    btt.addEventListener('click', () => {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                    btt.dataset.initialized = "true";
                }

                // Remove existing footers that ARE NOT our injected footer
                const existingFooters = document.querySelectorAll('footer:not(.injected-footer), .unified-footer:not(.injected-footer)');
                existingFooters.forEach(f => f.remove());

                // Check if already injected to avoid duplication on re-runs
                if (document.querySelector('.injected-footer')) return;

                const footerHTML = `
                <footer class="unified-footer injected-footer">
                    <p>
                        <span>arr0w1 <span style="margin: 0 4px; opacity: 0.3;">|</span> <a href="https://github.com/1135" target="_blank" class="author-link" style="color: inherit; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary-color)'" onmouseout="this.style.color='inherit'">1135</a></span>
                        <span style="opacity: 0.2;">|</span>
                        <span class="footer-donation-icons">
                            <a href="https://buymeacoffee.com/wi11x5" target="_blank" title="Buy me a coffee" class="donation-link">
                                <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee">
                            </a>
                            <a href="https://ko-fi.com/wi11x5" target="_blank" title="Ko-fi" class="donation-link">
                                <img src="https://storage.ko-fi.com/cdn/cup-border.png" alt="Ko-fi">
                            </a>
                        </span>
                    </p>
                </footer>`;

                document.body.insertAdjacentHTML('beforeend', footerHTML);
            };

            // Only run injection once the full page is likely ready
            if (document.readyState === 'complete') {
                injectFooter();
            } else {
                window.addEventListener('load', injectFooter);
            }
        };

        // Run immediately if elements exist (dynamic load), otherwise wait
        if (document.querySelector('.nav-dropdown-btn')) {
            initNavigation();
        } else {
            document.addEventListener('DOMContentLoaded', initNavigation);
        }
    })();
</script>